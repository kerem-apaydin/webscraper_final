{% extends "base.html" %}

{% block content %}
  <form method="POST" action="/" class="url-form">
      <input type="text" name="url" placeholder="DMO ürün sayfası linki girin" required>
      <button type="submit">Verileri Getir</button>
  </form>

  <form method="GET" action="/" class="url-form" style="margin-top:10px;">
      <input type="search" name="q" placeholder="Ürün ara..." value="{{ request.args.get('q', '') }}">
      <button type="submit">Ara</button>
  </form>

  <div class="product-container">
      <div class="product-grid">
          {% for product in products %}
          <div class="product-card">
              <img src="{{ product.image }}" alt="Resim">
              <h3>{{ product.title }}</h3>
              <p><strong>Tedarikçi:</strong> {{ product.supplier }}</p>
              <p class="price"><strong>Fiyat (KDV Dahil):</strong> {{ '%.2f'|format(product.price_v) }} ₺</p>

              {% if product.last_change_date %}
                  {% set cls = 'price-neutral' %}
                  {% if product.last_change_recent %}
                      {% if product.last_change_direction == 'up' %}
                          {% set cls = 'price-up' %}
                      {% elif product.last_change_direction == 'down' %}
                          {% set cls = 'price-down' %}
                      {% endif %}
                  {% endif %}
                  <p class="{{ cls }}"><strong>Son fiyat değişimi:</strong> {{ product.last_change_date }}</p>
              {% endif %}

              {% if product.alternatif_tedarikciler and product.alternatif_tedarikciler|length > 0 %}
              <div class="alt-suppliers">
                  <details>
                      <summary>Alternatif Tedarikçiler ({{ product.alternatif_tedarikciler|length }})</summary>
                      <ul>
                      {% for alt in product.alternatif_tedarikciler %}
                          <li>
                              {{ alt.supplier }} – {{ '%.2f'|format(alt.price_v) }} ₺
                              <a href="{{ alt.url }}" target="_blank">Görüntüle</a>
                          </li>
                      {% endfor %}
                      </ul>
                  </details>
              </div>
              {% endif %}

              <a href="{{ url_for('main.product_detail', product_code=product.product_code) }}">Detay</a>
          </div>
          {% endfor %}
      </div>
  </div>
{% endblock %}
